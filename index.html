<html>
    <head>
        <title>Letter_Cancellation</title>
        <link rel="stylesheet" href="stylesheet1.css">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes">
        <meta charset="utf-8">
    </head>
    <body>
        <label for="test_name">Enter your name:</label>
        <input type="text" id="test_name" name="temp_name"><br>
        <label for="test_age">Enter your age:</label>
        <input type="input" id="test_age" name="age"><br>
        <div class="container">
            <button id="start" onclick="put()">START</button>
        </div>
        <div class="container">
            <button id="stimulus">Test</button>
        </div>
        <div class="container">
            <div class="letter-container">
               <div class="row-1">
                    <button id="1_1" onclick="cancel(this.id)">A</button>
                   <button id="1_2" onclick="cancel(this.id)">A</button>
                   <button id="1_3" onclick="cancel(this.id)">A</button>
                   <button id="1_4" onclick="cancel(this.id)">A</button>
                   <button id="1_5" onclick="cancel(this.id)">A</button>
                   <button id="1_6" onclick="cancel(this.id)">A</button>
                   <button id="1_7" onclick="cancel(this.id)">A</button>
                   <button id="1_8" onclick="cancel(this.id)">A</button>
                   <button id="1_9" onclick="cancel(this.id)">A</button>
                   <button id="1_10" onclick="cancel(this.id)">A</button>
                   <button id="1_11" onclick="cancel(this.id)">A</button>
                   <button id="1_12" onclick="cancel(this.id)">A</button>
                   <button id="1_13" onclick="cancel(this.id)">A</button>
                   <button id="1_14" onclick="cancel(this.id)">A</button>
                   <button id="1_15" onclick="cancel(this.id)">A</button>
                   <button id="1_16" onclick="cancel(this.id)">A</button>
                   <button id="1_17" onclick="cancel(this.id)">A</button>
                   <button id="1_18" onclick="cancel(this.id)">A</button>
                   <button id="1_19" onclick="cancel(this.id)">A</button>
                   <button id="1_20" onclick="cancel(this.id)">A</button>
                   <button id="1_21" onclick="cancel(this.id)">A</button>
                   <button id="1_22" onclick="cancel(this.id)">A</button>
                   <button id="1_23" onclick="cancel(this.id)">A</button>
                   <button id="1_24" onclick="cancel(this.id)">A</button>
                   <button id="1_25" onclick="cancel(this.id)">A</button>
                   <button id="1_26" onclick="cancel(this.id)">A</button>
                   <button id="1_27" onclick="cancel(this.id)">A</button>
                   <button id="1_28" onclick="cancel(this.id)">A</button>
                   <button id="1_29" onclick="cancel(this.id)">A</button>
                   <button id="1_30" onclick="cancel(this.id)">A</button>
                   <button id="1_31" onclick="cancel(this.id)">A</button>
                   <button id="1_32" onclick="cancel(this.id)">A</button>
                   <button id="1_33" onclick="cancel(this.id)">A</button>
                   <button id="1_34" onclick="cancel(this.id)">A</button>
                   <button id="1_35" onclick="cancel(this.id)">A</button>
                   <button id="1_36" onclick="cancel(this.id)">A</button>
                   <button id="1_37" onclick="cancel(this.id)">A</button>
                   <button id="1_38" onclick="cancel(this.id)">A</button>
                   <button id="1_39" onclick="cancel(this.id)">A</button>
                   <button id="1_40" onclick="cancel(this.id)">A</button>
               </div>
                <div class="row-2">
                    <button id="2_1" onclick="cancel(this.id)">A</button>
                   <button id="2_2" onclick="cancel(this.id)">A</button>
                   <button id="2_3" onclick="cancel(this.id)">A</button>
                   <button id="2_4" onclick="cancel(this.id)">A</button>
                   <button id="2_5" onclick="cancel(this.id)">A</button>
                   <button id="2_6" onclick="cancel(this.id)">A</button>
                   <button id="2_7" onclick="cancel(this.id)">A</button>
                   <button id="2_8" onclick="cancel(this.id)">A</button>
                   <button id="2_9" onclick="cancel(this.id)">A</button>
                   <button id="2_10" onclick="cancel(this.id)">A</button>
                   <button id="2_11" onclick="cancel(this.id)">A</button>
                   <button id="2_12" onclick="cancel(this.id)">A</button>
                   <button id="2_13" onclick="cancel(this.id)">A</button>
                   <button id="2_14" onclick="cancel(this.id)">A</button>
                   <button id="2_15" onclick="cancel(this.id)">A</button>
                   <button id="2_16" onclick="cancel(this.id)">A</button>
                   <button id="2_17" onclick="cancel(this.id)">A</button>
                   <button id="2_18" onclick="cancel(this.id)">A</button>
                   <button id="2_19" onclick="cancel(this.id)">A</button>
                   <button id="2_20" onclick="cancel(this.id)">A</button>
                   <button id="2_21" onclick="cancel(this.id)">A</button>
                   <button id="2_22" onclick="cancel(this.id)">A</button>
                   <button id="2_23" onclick="cancel(this.id)">A</button>
                   <button id="2_24" onclick="cancel(this.id)">A</button>
                   <button id="2_25" onclick="cancel(this.id)">A</button>
                   <button id="2_26" onclick="cancel(this.id)">A</button>
                   <button id="2_27" onclick="cancel(this.id)">A</button>
                   <button id="2_28" onclick="cancel(this.id)">A</button>
                   <button id="2_29" onclick="cancel(this.id)">A</button>
                   <button id="2_30" onclick="cancel(this.id)">A</button>
                   <button id="2_31" onclick="cancel(this.id)">A</button>
                   <button id="2_32" onclick="cancel(this.id)">A</button>
                   <button id="2_33" onclick="cancel(this.id)">A</button>
                   <button id="2_34" onclick="cancel(this.id)">A</button>
                   <button id="2_35" onclick="cancel(this.id)">A</button>
                   <button id="2_36" onclick="cancel(this.id)">A</button>
                   <button id="2_37" onclick="cancel(this.id)">A</button>
                   <button id="2_38" onclick="cancel(this.id)">A</button>
                   <button id="2_39" onclick="cancel(this.id)">A</button>
                   <button id="2_40" onclick="cancel(this.id)">A</button>
               </div>
                <div class="row-3">
                    <button id="3_1" onclick="cancel(this.id)">A</button>
                   <button id="3_2" onclick="cancel(this.id)">A</button>
                   <button id="3_3" onclick="cancel(this.id)">A</button>
                   <button id="3_4" onclick="cancel(this.id)">A</button>
                   <button id="3_5" onclick="cancel(this.id)">A</button>
                   <button id="3_6" onclick="cancel(this.id)">A</button>
                   <button id="3_7" onclick="cancel(this.id)">A</button>
                   <button id="3_8" onclick="cancel(this.id)">A</button>
                   <button id="3_9" onclick="cancel(this.id)">A</button>
                   <button id="3_10" onclick="cancel(this.id)">A</button>
                   <button id="3_11" onclick="cancel(this.id)">A</button>
                   <button id="3_12" onclick="cancel(this.id)">A</button>
                   <button id="3_13" onclick="cancel(this.id)">A</button>
                   <button id="3_14" onclick="cancel(this.id)">A</button>
                   <button id="3_15" onclick="cancel(this.id)">A</button>
                   <button id="3_16" onclick="cancel(this.id)">A</button>
                   <button id="3_17" onclick="cancel(this.id)">A</button>
                   <button id="3_18" onclick="cancel(this.id)">A</button>
                   <button id="3_19" onclick="cancel(this.id)">A</button>
                   <button id="3_20" onclick="cancel(this.id)">A</button>
                   <button id="3_21" onclick="cancel(this.id)">A</button>
                   <button id="3_22" onclick="cancel(this.id)">A</button>
                   <button id="3_23" onclick="cancel(this.id)">A</button>
                   <button id="3_24" onclick="cancel(this.id)">A</button>
                   <button id="3_25" onclick="cancel(this.id)">A</button>
                   <button id="3_26" onclick="cancel(this.id)">A</button>
                   <button id="3_27" onclick="cancel(this.id)">A</button>
                   <button id="3_28" onclick="cancel(this.id)">A</button>
                   <button id="3_29" onclick="cancel(this.id)">A</button>
                   <button id="3_30" onclick="cancel(this.id)">A</button>
                   <button id="3_31" onclick="cancel(this.id)">A</button>
                   <button id="3_32" onclick="cancel(this.id)">A</button>
                   <button id="3_33" onclick="cancel(this.id)">A</button>
                   <button id="3_34" onclick="cancel(this.id)">A</button>
                   <button id="3_35" onclick="cancel(this.id)">A</button>
                   <button id="3_36" onclick="cancel(this.id)">A</button>
                   <button id="3_37" onclick="cancel(this.id)">A</button>
                   <button id="3_38" onclick="cancel(this.id)">A</button>
                   <button id="3_39" onclick="cancel(this.id)">A</button>
                   <button id="3_40" onclick="cancel(this.id)">A</button>
                </div>
                <div class="row-4">
                    <button id="4_1" onclick="cancel(this.id)">A</button>
                   <button id="4_2" onclick="cancel(this.id)">A</button>
                   <button id="4_3" onclick="cancel(this.id)">A</button>
                   <button id="4_4" onclick="cancel(this.id)">A</button>
                   <button id="4_5" onclick="cancel(this.id)">A</button>
                   <button id="4_6" onclick="cancel(this.id)">A</button>
                   <button id="4_7" onclick="cancel(this.id)">A</button>
                   <button id="4_8" onclick="cancel(this.id)">A</button>
                   <button id="4_9" onclick="cancel(this.id)">A</button>
                   <button id="4_10" onclick="cancel(this.id)">A</button>
                   <button id="4_11" onclick="cancel(this.id)">A</button>
                   <button id="4_12" onclick="cancel(this.id)">A</button>
                   <button id="4_13" onclick="cancel(this.id)">A</button>
                   <button id="4_14" onclick="cancel(this.id)">A</button>
                   <button id="4_15" onclick="cancel(this.id)">A</button>
                   <button id="4_16" onclick="cancel(this.id)">A</button>
                   <button id="4_17" onclick="cancel(this.id)">A</button>
                   <button id="4_18" onclick="cancel(this.id)">A</button>
                   <button id="4_19" onclick="cancel(this.id)">A</button>
                   <button id="4_20" onclick="cancel(this.id)">A</button>
                   <button id="4_21" onclick="cancel(this.id)">A</button>
                   <button id="4_22" onclick="cancel(this.id)">A</button>
                   <button id="4_23" onclick="cancel(this.id)">A</button>
                   <button id="4_24" onclick="cancel(this.id)">A</button>
                   <button id="4_25" onclick="cancel(this.id)">A</button>
                   <button id="4_26" onclick="cancel(this.id)">A</button>
                   <button id="4_27" onclick="cancel(this.id)">A</button>
                   <button id="4_28" onclick="cancel(this.id)">A</button>
                   <button id="4_29" onclick="cancel(this.id)">A</button>
                   <button id="4_30" onclick="cancel(this.id)">A</button>
                   <button id="4_31" onclick="cancel(this.id)">A</button>
                   <button id="4_32" onclick="cancel(this.id)">A</button>
                   <button id="4_33" onclick="cancel(this.id)">A</button>
                   <button id="4_34" onclick="cancel(this.id)">A</button>
                   <button id="4_35" onclick="cancel(this.id)">A</button>
                   <button id="4_36" onclick="cancel(this.id)">A</button>
                   <button id="4_37" onclick="cancel(this.id)">A</button>
                   <button id="4_38" onclick="cancel(this.id)">A</button>
                   <button id="4_39" onclick="cancel(this.id)">A</button>
                   <button id="4_40" onclick="cancel(this.id)">A</button>
               </div>
                <div class="row-5">
                    <button id="5_1" onclick="cancel(this.id)">A</button>
                   <button id="5_2" onclick="cancel(this.id)">A</button>
                   <button id="5_3" onclick="cancel(this.id)">A</button>
                   <button id="5_4" onclick="cancel(this.id)">A</button>
                   <button id="5_5" onclick="cancel(this.id)">A</button>
                   <button id="5_6" onclick="cancel(this.id)">A</button>
                   <button id="5_7" onclick="cancel(this.id)">A</button>
                   <button id="5_8" onclick="cancel(this.id)">A</button>
                   <button id="5_9" onclick="cancel(this.id)">A</button>
                   <button id="5_10" onclick="cancel(this.id)">A</button>
                   <button id="5_11" onclick="cancel(this.id)">A</button>
                   <button id="5_12" onclick="cancel(this.id)">A</button>
                   <button id="5_13" onclick="cancel(this.id)">A</button>
                   <button id="5_14" onclick="cancel(this.id)">A</button>
                   <button id="5_15" onclick="cancel(this.id)">A</button>
                   <button id="5_16" onclick="cancel(this.id)">A</button>
                   <button id="5_17" onclick="cancel(this.id)">A</button>
                   <button id="5_18" onclick="cancel(this.id)">A</button>
                   <button id="5_19" onclick="cancel(this.id)">A</button>
                   <button id="5_20" onclick="cancel(this.id)">A</button>
                   <button id="5_21" onclick="cancel(this.id)">A</button>
                   <button id="5_22" onclick="cancel(this.id)">A</button>
                   <button id="5_23" onclick="cancel(this.id)">A</button>
                   <button id="5_24" onclick="cancel(this.id)">A</button>
                   <button id="5_25" onclick="cancel(this.id)">A</button>
                   <button id="5_26" onclick="cancel(this.id)">A</button>
                   <button id="5_27" onclick="cancel(this.id)">A</button>
                   <button id="5_28" onclick="cancel(this.id)">A</button>
                   <button id="5_29" onclick="cancel(this.id)">A</button>
                   <button id="5_30" onclick="cancel(this.id)">A</button>
                   <button id="5_31" onclick="cancel(this.id)">A</button>
                   <button id="5_32" onclick="cancel(this.id)">A</button>
                   <button id="5_33" onclick="cancel(this.id)">A</button>
                   <button id="5_34" onclick="cancel(this.id)">A</button>
                   <button id="5_35" onclick="cancel(this.id)">A</button>
                   <button id="5_36" onclick="cancel(this.id)">A</button>
                   <button id="5_37" onclick="cancel(this.id)">A</button>
                   <button id="5_38" onclick="cancel(this.id)">A</button>
                   <button id="5_39" onclick="cancel(this.id)">A</button>
                   <button id="5_40" onclick="cancel(this.id)">A</button>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="timer">
                <h1 id="timer">03:00</h1>
            </div>
        </div>
        <div class="container">
            <div class="fin">
                <button id="finish" onclick="check()">Finish</button>
            </div>
        </div>
    </body>
 <!--   <script src="jquery-2.1.4.js"></script>  -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <script>
        var stim=Math.floor(Math.random()*26);
        
        var i,j,x,y,temp,click;
        
        var par=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];
        var temp_name,age;
        
var pos=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,
51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,
101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,
139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,
178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200];
        
var apos=[];
var stimpos=new Array();
        
function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;
    while (0 !== currentIndex) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }
  return array;
}
        
function set(){
var x="";
    for(var i=1;i<=5;++i)
    {
        for(var j=1;j<=40;++j){
            x=String(i)+"_"+String(j);
            document.getElementById(x).innerHTML=apos[(((i-1)*40)+j)];
        }
    }
}
  
function makeid(length) {
   var result           = '';
   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
   var charactersLength = characters.length;
   for ( var i = 0; i < length; i++ ) {
      result += characters.charAt(Math.floor(Math.random() * charactersLength));
       while(result===par[stim]){
           result = characters.charAt(Math.floor(Math.random() * charactersLength));
       }
   }
   return result;
}
      
var temp1 = new Array();
var m,s;
var timeArray;
var presentTime;    

function startTimer() {
  presentTime = document.getElementById("timer").innerHTML;
  timeArray = presentTime.split(/[:]+/);
  m = timeArray[0];
  s = checkSecond((timeArray[1] - 1));
  if(s==59){m=m-1}
  
  
  document.getElementById('timer').innerHTML = m + ":" + s;
  if(m>=0){
  setTimeout(startTimer,1000);
  }
  else{
   alert('Time\'s Up');check();reset();location.reload();
  }
}

var cancelled=new Array(201).fill(0);
var y;

function update(id){
    y=document.getElementById(id);
    y.style.color="blue";
    y.style.fontWeight="bold";
}

function cancel(clicked_id){
    update(clicked_id);
    var str=clicked_id.split("");
    if(str.length===3){
        cancelled[Number(str[0]-1)*40+Number(str[2])]=1;
    }
    else{
        cancelled[Number(str[0]-1)*40+Number(str[2]*10)+Number(str[3])]=1;
    }
}

        
function checkSecond(sec) {
  if (sec < 10 && sec >= 0) {sec = "0" + sec}; // add zero in front of numbers < 10
  if (sec < 0) {sec = "59"};
  return sec;
}

var today;
var date,time,dateTime;
var left=0;
var right=0;
var wrong=0;
var mark=0;
var click=0;
       
        function put() {
            temp_name=document.getElementById("test_name").value;
            age=document.getElementById("test_age").value;
            document.getElementById("stimulus").innerHTML=par[stim];        
            pos=shuffle(pos)
            for(var i=0;i<60;i++){
                        apos[pos[i]]=par[stim];    
                } 

            for(var i=60;i<200;i++){
                        apos[pos[i]]=makeid(1);    
                } 
            document.getElementById("timer").innerHTML="03:00";
            if(click!==1){startTimer();}
            click=1;
            today=new Date();
            date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
            time = today.getHours()+":"+today.getMinutes()+":"+ today.getSeconds();
            dateTime = date+" "+time;
            set();        
        }

        function check(){
            right=0;
            mark=0;
            wrong=0;
            left=0;
                for(i=1;i<=200;i++){
                    if(cancelled[i]===1){
                            if(apos[i]===par[stim]){  
                                right=right+1;
                        }
                        mark=mark+1;
                    }
                }
                left=60-right;
                wrong=mark-right;
                generate();
                location.reload();
                reset();
        }

    function generate(){
                var doc=new jsPDF();
                var file_name;
                doc.setFontSize(32);
                doc.setTextColor(0, 19, 32);
                doc.text(20,20,"Name: "+temp_name);
                doc.text(20,38,"Age: "+age);
                doc.text(20,71,"Total characters marked: "+mark);
                doc.text(20,103,"Correct characters marked: "+right);
                doc.text(20,135,"Incorrect characters marked: "+wrong);
                doc.text(20,166,"Characters omitted: "+left);
                doc.text(20,198,"Time taken: "+(2-m)+"m "+(60-s)+"s");
                doc.text(20,280,"Test taken at: "+dateTime);
                file_name=temp_name+"_"+dateTime;
                doc.save(file_name+'.pdf');
    }

    function reset(){
        document.getElementById("timer").innerHTML="03:00";
        click=0;
        m=3;
        s=0;  
    }    
//pos->stimulus saved  apos->values         
    </script>
</html>